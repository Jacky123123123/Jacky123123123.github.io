<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create Your Meal Kit</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Tailwind 配置 -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#4CAF50',
                        secondary: '#FF9800',
                        neutral: '#F5F7FA',
                        dark: '#2D3748'
                    },
                    fontFamily: {
                        inter: ['Inter', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .text-shadow {
                text-shadow: 0 2px 4px rgba(0,0,0,0.1);
            }
            .transition-transform-opacity {
                transition-property: transform, opacity;
            }
            .pack-shadow {
                box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1);
            }
            .ingredient-hover {
                @apply transition-all duration-300 hover:scale-105 hover:shadow-lg cursor-move;
            }
            .dragging {
                @apply opacity-70 scale-110;
            }
        }
    </style>
</head>
<body class="font-inter bg-neutral min-h-screen text-dark overflow-x-hidden">
    <!-- 页面容器 -->
    <div class="relative w-full min-h-screen">
        
        <!-- 邀请页面 -->
        <section id="invite-page" class="absolute inset-0 flex flex-col items-center justify-center p-4 transition-all duration-500">
            <div class="w-full max-w-md bg-white rounded-2xl shadow-xl p-8 transform transition-all duration-500 hover:shadow-2xl">
                <div class="text-center mb-8">
                    <div class="w-16 h-16 bg-primary/10 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="fa fa-cutlery text-2xl text-primary"></i>
                    </div>
                    <h1 class="text-[clamp(1.5rem,3vw,2.5rem)] font-bold text-dark mb-2">Meal Kit Creator</h1>
                    <p class="text-gray-500">You're invited to design your perfect meal kit</p>
                </div>
                
                <div class="space-y-4">
                    <p class="text-gray-600 text-sm">Please enter the password to access the creator tool</p>
                    
                    <div class="relative">
                        <input type="password" id="password" 
                               class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-primary/50 focus:border-primary outline-none transition-all"
                               placeholder="Enter password">
                        <button id="toggle-password" class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600">
                            <i class="fa fa-eye-slash"></i>
                        </button>
                    </div>
                    
                    <button id="enter-btn" 
                            class="w-full bg-primary hover:bg-primary/90 text-white font-medium py-3 px-4 rounded-lg transition-all duration-300 transform hover:scale-[1.02] hover:shadow-lg">
                        Enter Creator
                    </button>
                    
                    <p id="password-error" class="text-red-500 text-sm text-center hidden">Incorrect password. Please try again (hint: 123456)</p>
                </div>
            </div>
            
            <div class="mt-8 text-center text-gray-500 text-sm">
                <p>Powered by Meal Kit Design Lab</p>
            </div>
        </section>
        
        <!-- 包装选择页面 -->
        <section id="pack-selection-page" class="absolute inset-0 p-4 opacity-0 pointer-events-none transition-all duration-500">
            <div class="max-w-6xl mx-auto">
                <header class="py-6 mb-8">
                    <div class="flex justify-between items-center">
                        <div class="flex items-center">
                            <i class="fa fa-cutlery text-2xl text-primary mr-2"></i>
                            <h1 class="text-2xl font-bold">Meal Kit Creator</h1>
                        </div>
                        <button id="back-to-invite" class="text-gray-500 hover:text-primary transition-colors">
                            <i class="fa fa-arrow-left mr-1"></i> Back
                        </button>
                    </div>
                </header>
                
                <main>
                    <div class="text-center mb-12">
                        <h2 class="text-[clamp(1.5rem,3vw,2.2rem)] font-bold mb-3">Choose Your Package Size</h2>
                        <p class="text-gray-600 max-w-2xl mx-auto">Select the size of your meal kit package to get started with your design</p>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                        <!-- 小包装 -->
                        <div class="pack-option bg-white rounded-xl overflow-hidden pack-shadow cursor-pointer transition-all duration-300 hover:scale-[1.03] hover:shadow-2xl" data-size="small">
                            <div class="h-48 overflow-hidden bg-neutral">
                                <img src="https://picsum.photos/id/292/600/400" alt="Small meal kit package" class="w-full h-full object-cover transition-transform duration-500 hover:scale-110">
                            </div>
                            <div class="p-6">
                                <h3 class="text-xl font-semibold mb-2">Small Package</h3>
                                <p class="text-gray-600 text-sm mb-4">Perfect for individual meals or small portions</p>
                                <div class="flex justify-between items-center">
                                    <span class="text-sm text-gray-500">2-3 ingredients</span>
                                    <div class="w-10 h-10 rounded-full border-2 border-gray-200 flex items-center justify-center">
                                        <i class="fa fa-check text-primary opacity-0 transition-opacity duration-300"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 中包装 -->
                        <div class="pack-option bg-white rounded-xl overflow-hidden pack-shadow cursor-pointer transition-all duration-300 hover:scale-[1.03] hover:shadow-2xl" data-size="medium">
                            <div class="h-48 overflow-hidden bg-neutral">
                                <img src="https://picsum.photos/id/431/600/400" alt="Medium meal kit package" class="w-full h-full object-cover transition-transform duration-500 hover:scale-110">
                            </div>
                            <div class="p-6">
                                <h3 class="text-xl font-semibold mb-2">Medium Package</h3>
                                <p class="text-gray-600 text-sm mb-4">Ideal for couples or family meals</p>
                                <div class="flex justify-between items-center">
                                    <span class="text-sm text-gray-500">4-6 ingredients</span>
                                    <div class="w-10 h-10 rounded-full border-2 border-gray-200 flex items-center justify-center">
                                        <i class="fa fa-check text-primary opacity-0 transition-opacity duration-300"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 大包装 -->
                        <div class="pack-option bg-white rounded-xl overflow-hidden pack-shadow cursor-pointer transition-all duration-300 hover:scale-[1.03] hover:shadow-2xl" data-size="large">
                            <div class="h-48 overflow-hidden bg-neutral">
                                <img src="https://picsum.photos/id/225/600/400" alt="Large meal kit package" class="w-full h-full object-cover transition-transform duration-500 hover:scale-110">
                            </div>
                            <div class="p-6">
                                <h3 class="text-xl font-semibold mb-2">Large Package</h3>
                                <p class="text-gray-600 text-sm mb-4">Great for larger families or multiple meals</p>
                                <div class="flex justify-between items-center">
                                    <span class="text-sm text-gray-500">7+ ingredients</span>
                                    <div class="w-10 h-10 rounded-full border-2 border-gray-200 flex items-center justify-center">
                                        <i class="fa fa-check text-primary opacity-0 transition-opacity duration-300"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="text-center mt-12">
                        <button id="continue-to-design" 
                                class="bg-primary hover:bg-primary/90 text-white font-medium py-3 px-8 rounded-lg transition-all duration-300 transform hover:scale-[1.02] hover:shadow-lg opacity-50 cursor-not-allowed"
                                disabled>
                            Continue to Design <i class="fa fa-arrow-right ml-2"></i>
                        </button>
                    </div>
                </main>
            </div>
        </section>
        
        <!-- 设计页面 -->
        <section id="design-page" class="absolute inset-0 p-4 opacity-0 pointer-events-none transition-all duration-500">
            <div class="max-w-7xl mx-auto">
                <header class="py-6 mb-6">
                    <div class="flex justify-between items-center">
                        <div class="flex items-center">
                            <i class="fa fa-cutlery text-2xl text-primary mr-2"></i>
                            <h1 class="text-2xl font-bold">Meal Kit Creator</h1>
                        </div>
                        <div class="flex space-x-4">
                            <button id="back-to-packs" class="text-gray-500 hover:text-primary transition-colors">
                                <i class="fa fa-arrow-left mr-1"></i> Back
                            </button>
                            <button id="reset-design" class="text-gray-500 hover:text-red-500 transition-colors">
                                <i class="fa fa-refresh mr-1"></i> Reset
                            </button>
                        </div>
                    </div>
                </header>
                
                <main>
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                        <!-- 左侧：包装预览区 -->
                        <div class="lg:col-span-2">
                            <div class="bg-white rounded-xl shadow-lg p-6 h-full">
                                <h2 class="text-xl font-semibold mb-4 flex items-center">
                                    <i class="fa fa-package text-primary mr-2"></i> Your Meal Kit
                                    <span id="pack-size-display" class="ml-2 text-sm bg-primary/10 text-primary px-2 py-1 rounded-full"></span>
                                </h2>
                                
                                <div id="pack-preview-container" class="w-full bg-neutral rounded-lg min-h-[400px] flex items-center justify-center p-4 relative overflow-hidden">
                                    <!-- 包装图片将在这里显示 -->
                                    <div id="pack-preview" class="relative w-full max-w-md mx-auto transition-all duration-300">
                                        <img id="selected-pack-image" src="" alt="Selected package" class="w-full h-auto rounded-lg">
                                        <div id="ingredients-container" class="absolute inset-0 rounded-lg overflow-hidden">
                                            <!-- 拖拽的食材将在这里显示 -->
                                        </div>
                                    </div>
                                    
                                    <!-- 初始提示 -->
                                    <div id="pack-instruction" class="absolute text-center text-gray-500">
                                        <i class="fa fa-arrow-right text-2xl mb-2 block"></i>
                                        <p>Search and drag ingredients here</p>
                                    </div>
                                </div>
                                
                                <div class="mt-6 flex justify-between items-center">
                                    <div>
                                        <span id="ingredients-count" class="text-sm font-medium">0 ingredients added</span>
                                    </div>
                                    <button id="complete-design" class="bg-secondary hover:bg-secondary/90 text-white font-medium py-2 px-6 rounded-lg transition-all duration-300">
                                        Complete Design <i class="fa fa-check ml-1"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 右侧：食材搜索和选择区 -->
                        <div>
                            <div class="bg-white rounded-xl shadow-lg p-6 sticky top-4">
                                <h2 class="text-xl font-semibold mb-4 flex items-center">
                                    <i class="fa fa-search text-primary mr-2"></i> Find Ingredients
                                </h2>
                                
                                <div class="mb-6">
                                    <div class="relative">
                                        <input type="text" id="ingredient-search" 
                                               class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-primary/50 focus:border-primary outline-none transition-all pr-10"
                                               placeholder="Search for ingredients...">
                                        <i class="fa fa-search absolute right-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
                                    </div>
                                </div>
                                
                                <h3 class="font-medium mb-3">Popular Ingredients</h3>
                                
                                <div id="ingredients-grid" class="grid grid-cols-2 gap-3 max-h-[400px] overflow-y-auto pr-1">
                                    <!-- 食材将通过JS动态加载 -->
                                </div>
                            </div>
                        </div>
                    </div>
                </main>
            </div>
        </section>
        
        <!-- 完成弹窗 -->
        <div id="completion-modal" class="fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50 opacity-0 pointer-events-none transition-opacity duration-300">
            <div class="bg-white rounded-2xl max-w-md w-full p-8 transform transition-transform duration-300 scale-95">
                <div class="text-center">
                    <div class="w-16 h-16 bg-primary/10 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="fa fa-check text-2xl text-primary"></i>
                    </div>
                    <h2 class="text-2xl font-bold mb-2">Design Complete!</h2>
                    <p class="text-gray-600 mb-6">Your meal kit design is finished. Great job!</p>
                    
                    <div class="flex flex-col space-y-3">
                        <button id="create-new-design" class="w-full bg-primary hover:bg-primary/90 text-white font-medium py-3 px-4 rounded-lg transition-all duration-300">
                            Create Another Design
                        </button>
                        <button id="close-modal" class="w-full bg-gray-100 hover:bg-gray-200 text-gray-700 font-medium py-3 px-4 rounded-lg transition-all duration-300">
                            Close
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 页面元素
        const invitePage = document.getElementById('invite-page');
        const packSelectionPage = document.getElementById('pack-selection-page');
        const designPage = document.getElementById('design-page');
        const passwordInput = document.getElementById('password');
        const togglePasswordBtn = document.getElementById('toggle-password');
        const enterBtn = document.getElementById('enter-btn');
        const passwordError = document.getElementById('password-error');
        const backToInviteBtn = document.getElementById('back-to-invite');
        const packOptions = document.querySelectorAll('.pack-option');
        const continueToDesignBtn = document.getElementById('continue-to-design');
        const backToPacksBtn = document.getElementById('back-to-packs');
        const resetDesignBtn = document.getElementById('reset-design');
        const ingredientSearch = document.getElementById('ingredient-search');
        const ingredientsGrid = document.getElementById('ingredients-grid');
        const packPreview = document.getElementById('pack-preview');
        const selectedPackImage = document.getElementById('selected-pack-image');
        const packSizeDisplay = document.getElementById('pack-size-display');
        const ingredientsContainer = document.getElementById('ingredients-container');
        const ingredientsCount = document.getElementById('ingredients-count');
        const completeDesignBtn = document.getElementById('complete-design');
        const completionModal = document.getElementById('completion-modal');
        const createNewDesignBtn = document.getElementById('create-new-design');
        const closeModalBtn = document.getElementById('close-modal');
        const packInstruction = document.getElementById('pack-instruction');
        
        // 状态变量
        let selectedPack = null;
        let draggedIngredient = null;
        let ingredientCount = 0;
        
        // 食材数据
        const ingredients = [
            { id: 1, name: 'Tomato', image: 'https://picsum.photos/id/1080/200/200' },
            { id: 2, name: 'Lettuce', image: 'https://picsum.photos/id/139/200/200' },
            { id: 3, name: 'Carrot', image: 'https://picsum.photos/id/129/200/200' },
            { id: 4, name: 'Broccoli', image: 'https://picsum.photos/id/292/200/200' },
            { id: 5, name: 'Chicken', image: 'https://picsum.photos/id/488/200/200' },
            { id: 6, name: 'Beef', image: 'https://picsum.photos/id/312/200/200' },
            { id: 7, name: 'Potato', image: 'https://picsum.photos/id/1080/200/200?random=1' },
            { id: 8, name: 'Rice', image: 'https://picsum.photos/id/1080/200/200?random=2' },
            { id: 9, name: 'Cheese', image: 'https://picsum.photos/id/1080/200/200?random=3' },
            { id: 10, name: 'Onion', image: 'https://picsum.photos/id/1080/200/200?random=4' },
            { id: 11, name: 'Garlic', image: 'https://picsum.photos/id/1080/200/200?random=5' },
            { id: 12, name: 'Pepper', image: 'https://picsum.photos/id/1080/200/200?random=6' },
            { id: 13, name: 'Mushroom', image: 'https://picsum.photos/id/1080/200/200?random=7' },
            { id: 14, name: 'Spinach', image: 'https://picsum.photos/id/1080/200/200?random=8' },
            { id: 15, name: 'Salmon', image: 'https://picsum.photos/id/1080/200/200?random=9' }
        ];
        
        // 包装图片
        const packImages = {
            small: 'https://picsum.photos/id/292/600/400',
            medium: 'https://picsum.photos/id/431/600/400',
            large: 'https://picsum.photos/id/225/600/400'
        };
        
        // 初始化食材网格
        function renderIngredients(filter = '') {
            ingredientsGrid.innerHTML = '';
            
            const filteredIngredients = filter 
                ? ingredients.filter(ing => ing.name.toLowerCase().includes(filter.toLowerCase()))
                : ingredients;
            
            filteredIngredients.forEach(ingredient => {
                const ingredientEl = document.createElement('div');
                ingredientEl.className = 'ingredient-item bg-neutral rounded-lg overflow-hidden ingredient-hover';
                ingredientEl.draggable = true;
                ingredientEl.setAttribute('data-id', ingredient.id);
                
                ingredientEl.innerHTML = `
                    <div class="h-24 overflow-hidden">
                        <img src="${ingredient.image}" alt="${ingredient.name}" class="w-full h-full object-cover">
                    </div>
                    <div class="p-2 text-center">
                        <p class="text-sm font-medium truncate">${ingredient.name}</p>
                    </div>
                `;
                
                // 添加拖拽事件
                ingredientEl.addEventListener('dragstart', handleDragStart);
                
                ingredientsGrid.appendChild(ingredientEl);
            });
        }
        
        // 拖拽开始
        function handleDragStart(e) {
            draggedIngredient = this;
            this.classList.add('dragging');
            
            // 设置拖拽数据
            e.dataTransfer.setData('text/plain', this.getAttribute('data-id'));
            
            // 拖拽视觉效果
            setTimeout(() => {
                this.style.opacity = '0.4';
            }, 0);
        }
        
        // 拖拽结束
        function handleDragEnd() {
            this.classList.remove('dragging');
            this.style.opacity = '1';
            draggedIngredient = null;
        }
        
        // 允许放置
        function handleDragOver(e) {
            e.preventDefault();
            this.classList.add('bg-primary/5');
        }
        
        // 离开放置区域
        function handleDragLeave() {
            this.classList.remove('bg-primary/5');
        }
        
        // 放置
        function handleDrop(e) {
            e.preventDefault();
            this.classList.remove('bg-primary/5');
            
            if (draggedIngredient) {
                const ingredientId = e.dataTransfer.getData('text/plain');
                const ingredient = ingredients.find(ing => ing.id === parseInt(ingredientId));
                
                if (ingredient) {
                    addIngredientToPack(ingredient);
                }
            }
        }
        
        // 添加食材到包装
        function addIngredientToPack(ingredient) {
            // 隐藏提示
            packInstruction.classList.add('opacity-0');
            setTimeout(() => {
                packInstruction.classList.add('hidden');
            }, 300);
            
            // 创建食材元素
            const ingredientEl = document.createElement('div');
            ingredientEl.className = 'absolute rounded-md overflow-hidden shadow-md transition-all duration-300 transform hover:scale-110 hover:z-10';
            
            // 随机位置和大小
            const size = Math.floor(Math.random() * 30) + 60; // 60-90px
            const maxLeft = 100 - size / 2;
            const maxTop = 100 - size / 2;
            const left = Math.floor(Math.random() * maxLeft);
            const top = Math.floor(Math.random() * maxTop);
            
            ingredientEl.style.width = `${size}px`;
            ingredientEl.style.height = `${size}px`;
            ingredientEl.style.left = `${left}%`;
            ingredientEl.style.top = `${top}%`;
            
            ingredientEl.innerHTML = `
                <img src="${ingredient.image}" alt="${ingredient.name}" class="w-full h-full object-cover">
                <button class="remove-ingredient absolute -top-2 -right-2 w-5 h-5 bg-red-500 text-white rounded-full flex items-center justify-center text-xs hover:bg-red-600 transition-colors">
                    <i class="fa fa-times"></i>
                </button>
            `;
            
            // 添加到容器
            ingredientsContainer.appendChild(ingredientEl);
            
            // 更新计数
            ingredientCount++;
            updateIngredientsCount();
            
            // 添加删除事件
            ingredientEl.querySelector('.remove-ingredient').addEventListener('click', () => {
                // 淡出动画
                ingredientEl.style.opacity = '0';
                ingredientEl.style.transform = 'scale(0)';
                
                setTimeout(() => {
                    ingredientEl.remove();
                    ingredientCount--;
                    updateIngredientsCount();
                    
                    // 如果没有食材了，显示提示
                    if (ingredientCount === 0) {
                        packInstruction.classList.remove('hidden');
                        setTimeout(() => {
                            packInstruction.classList.remove('opacity-0');
                        }, 10);
                    }
                }, 300);
            });
            
            // 允许在包装内拖动调整位置
            makeIngredientDraggable(ingredientEl);
        }
        
        // 使食材在包装内可拖动
        function makeIngredientDraggable(element) {
            let pos1 = 0, pos2 = 0, pos3 = 0, pos4 = 0;
            
            element.onmousedown = dragMouseDown;
            
            function dragMouseDown(e) {
                e = e || window.event;
                e.preventDefault();
                
                // 获取鼠标初始位置
                pos3 = e.clientX;
                pos4 = e.clientY;
                
                // 提升层级，显示在最上层
                element.style.zIndex = '100';
                
                document.onmouseup = closeDragElement;
                document.onmousemove = elementDrag;
            }
            
            function elementDrag(e) {
                e = e || window.event;
                e.preventDefault();
                
                // 计算新的位置
                pos1 = pos3 - e.clientX;
                pos2 = pos4 - e.clientY;
                pos3 = e.clientX;
                pos4 = e.clientY;
                
                // 获取包装容器的位置和尺寸
                const containerRect = ingredientsContainer.getBoundingClientRect();
                const elementRect = element.getBoundingClientRect();
                const elementWidth = elementRect.width;
                const elementHeight = elementRect.height;
                
                // 计算新位置（相对于容器的百分比）
                let newLeft = (element.offsetLeft - pos1) / containerRect.width * 100;
                let newTop = (element.offsetTop - pos2) / containerRect.height * 100;
                
                // 限制在容器内
                newLeft = Math.max(0, Math.min(100 - (elementWidth / containerRect.width * 100), newLeft));
                newTop = Math.max(0, Math.min(100 - (elementHeight / containerRect.height * 100), newTop));
                
                // 设置新位置
                element.style.left = newLeft + '%';
                element.style.top = newTop + '%';
            }
            
            function closeDragElement() {
                // 停止移动
                document.onmouseup = null;
                document.onmousemove = null;
                
                // 恢复层级
                element.style.zIndex = '10';
            }
        }
        
        // 更新食材计数显示
        function updateIngredientsCount() {
            ingredientsCount.textContent = `${ingredientCount} ${ingredientCount === 1 ? 'ingredient' : 'ingredients'} added`;
            
            // 启用/禁用完成按钮
            if (ingredientCount > 0) {
                completeDesignBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                completeDesignBtn.disabled = false;
            } else {
                completeDesignBtn.classList.add('opacity-50', 'cursor-not-allowed');
                completeDesignBtn.disabled = true;
            }
        }
        
        // 重置设计
        function resetDesign() {
            ingredientsContainer.innerHTML = '';
            ingredientCount = 0;
            updateIngredientsCount();
            
            // 显示提示
            packInstruction.classList.remove('hidden', 'opacity-0');
        }
        
        // 显示完成弹窗
        function showCompletionModal() {
            completionModal.classList.remove('opacity-0', 'pointer-events-none');
            completionModal.querySelector('div').classList.remove('scale-95');
            completionModal.querySelector('div').classList.add('scale-100');
        }
        
        // 隐藏完成弹窗
        function hideCompletionModal() {
            completionModal.classList.add('opacity-0', 'pointer-events-none');
            completionModal.querySelector('div').classList.remove('scale-100');
            completionModal.querySelector('div').classList.add('scale-95');
        }
        
        // 页面切换函数
        function showPage(page) {
            // 隐藏所有页面
            invitePage.classList.add('opacity-0', 'pointer-events-none');
            packSelectionPage.classList.add('opacity-0', 'pointer-events-none');
            designPage.classList.add('opacity-0', 'pointer-events-none');
            
            // 显示目标页面
            page.classList.remove('opacity-0', 'pointer-events-none');
        }
        
        // 事件监听：密码切换显示/隐藏
        togglePasswordBtn.addEventListener('click', () => {
            const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
            passwordInput.setAttribute('type', type);
            
            // 切换图标
            const icon = togglePasswordBtn.querySelector('i');
            if (type === 'password') {
                icon.classList.remove('fa-eye');
                icon.classList.add('fa-eye-slash');
            } else {
                icon.classList.remove('fa-eye-slash');
                icon.classList.add('fa-eye');
            }
        });
        
        // 事件监听：密码提交
        enterBtn.addEventListener('click', () => {
            const password = passwordInput.value.trim();
            
            if (password === '123456') {
                passwordError.classList.add('hidden');
                showPage(packSelectionPage);
                passwordInput.value = '';
            } else {
                passwordError.classList.remove('hidden');
                
                // 抖动动画
                passwordInput.classList.add('animate-shake');
                setTimeout(() => {
                    passwordInput.classList.remove('animate-shake');
                }, 500);
            }
        });
        
        // 回车提交密码
        passwordInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                enterBtn.click();
            }
        });
        
        // 事件监听：返回邀请页面
        backToInviteBtn.addEventListener('click', () => {
            showPage(invitePage);
        });
        
        // 事件监听：包装选择
        packOptions.forEach(option => {
            option.addEventListener('click', () => {
                // 重置所有选择状态
                packOptions.forEach(opt => {
                    opt.classList.remove('ring-2', 'ring-primary');
                    opt.querySelector('.fa-check').classList.add('opacity-0');
                    opt.querySelector('.rounded-full').classList.remove('bg-primary/10', 'border-primary');
                    opt.querySelector('.rounded-full').classList.add('border-gray-200');
                });
                
                // 设置当前选择
                option.classList.add('ring-2', 'ring-primary');
                option.querySelector('.fa-check').classList.remove('opacity-0');
                option.querySelector('.rounded-full').classList.add('bg-primary/10', 'border-primary');
                option.querySelector('.rounded-full').classList.remove('border-gray-200');
                
                // 保存选择
                selectedPack = option.getAttribute('data-size');
                
                // 启用继续按钮
                continueToDesignBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                continueToDesignBtn.disabled = false;
            });
        });
        
        // 事件监听：继续到设计页面
        continueToDesignBtn.addEventListener('click', () => {
            if (selectedPack) {
                // 设置包装图片
                selectedPackImage.src = packImages[selectedPack];
                packSizeDisplay.textContent = selectedPack.charAt(0).toUpperCase() + selectedPack.slice(1);
                
                // 重置设计状态
                resetDesign();
                
                // 显示设计页面
                showPage(designPage);
            }
        });
        
        // 事件监听：返回包装选择
        backToPacksBtn.addEventListener('click', () => {
            showPage(packSelectionPage);
        });
        
        // 事件监听：重置设计
        resetDesignBtn.addEventListener('click', resetDesign);
        
        // 事件监听：食材搜索
        ingredientSearch.addEventListener('input', (e) => {
            renderIngredients(e.target.value);
        });
        
        // 事件监听：完成设计
        completeDesignBtn.addEventListener('click', showCompletionModal);
        
        // 事件监听：创建新设计
        createNewDesignBtn.addEventListener('click', () => {
            hideCompletionModal();
            showPage(packSelectionPage);
        });
        
        // 事件监听：关闭弹窗
        closeModalBtn.addEventListener('click', hideCompletionModal);
        
        // 设置包装预览区域的拖拽事件
        packPreview.addEventListener('dragover', handleDragOver);
        packPreview.addEventListener('dragleave', handleDragLeave);
        packPreview.addEventListener('drop', handleDrop);
        
        // 初始化
        window.addEventListener('DOMContentLoaded', () => {
            renderIngredients();
            
            // 添加拖拽结束事件监听
            document.addEventListener('dragend', handleDragEnd);
        });
    </script>
</body>
</html>